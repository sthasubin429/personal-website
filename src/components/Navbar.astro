---
import { LayoutGrid } from '@lucide/astro';
import MenuLinks from '@components/Navbar/MenuLinks.astro';
import MainLink from './Navbar/MainLink.astro';
---

<nav
  id="navbar"
  class="fixed bottom-0 left-0 w-full h-16 z-[999] sm:top-0 sm:left-0 px-4 backdrop-blur-xs transition-transform duration-300 ease-in-out"
  class="fixed bottom-0 left-0 w-full h-16 z-[999] sm:top-0 sm:left-0 px-4 backdrop-blur-xs transition-transform duration-300 ease-in-out sm:translate-y-0"
>
  <div class="container mx-auto h-16 flex flex-nowrap items-center justify-between">
    <div class="flex items-center">
      <a href="#" class="font-medium">
        <h4 class="text-xl font-semibold">
          Subin<span class="text-teal-300">Shrestha</span>
        </h4>
      </a>
    </div>
    <div class="flex justify-evenly items-center font-mono">
      <div class="hidden sm:block">
        <ul class="flex flex-row items-center justify-end ml-2">
          <li class="mx-4">
            <MainLink href="#about"> About </MainLink>
          </li>
          <li class="mx-4">
            <MainLink href="#projects"> Projects </MainLink>
          </li>
          <li class="mx-4">
            <MainLink href="#experience"> Experience </MainLink>
          </li>
          <li class="mx-4">
            <MainLink href="#contact"> Contact </MainLink>
          </li>
        </ul>
      </div>
      <!-- Mobile menu toggle button -->
      <button
        id="mobile-menu-toggle"
        class="block sm:hidden p-2 relative"
        aria-label="Toggle mobile menu"
      >
        <LayoutGrid />
      </button>
    </div>
  </div>

  <!-- Mobile menu with smooth slide animation -->
  <div
    id="mobile-menu"
    class="fixed bottom-16 left-0 w-full z-[999] lg:hidden shadow-lg transform transition-all duration-300 ease-in-out translate-y-full opacity-0 pointer-events-none bg-white/10 backdrop-blur-sm"
  >
    <div class="flex justify-center">
      <ul class="text-center m-2 py-4">
        <MenuLinks href="#about" label="About" />
        <MenuLinks href="#projects" label="Projects" />
        <MenuLinks href="#experience" label="Experience" />
        <MenuLinks href="#contact" label="Contact" />
      </ul>
    </div>
  </div>
</nav>

<script>
  // Mobile menu functionality
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuItems = document.querySelectorAll('.mobile-menu-item');
  const mobileMenuLinks = document.querySelectorAll('.mobile-menu-link');

  let isMenuOpen = false;

  function toggleMobileMenu() {
    isMenuOpen = !isMenuOpen;

    if (isMenuOpen) {
      // Open menu
      mobileMenu?.classList.remove('translate-y-full', 'opacity-0', 'pointer-events-none');
      mobileMenu?.classList.add('translate-y-0', 'opacity-100');

      // Animate menu items
      mobileMenuItems.forEach(item => {
        item.classList.remove('translate-y-4', 'opacity-0');
        item.classList.add('translate-y-0', 'opacity-100');
      });
    } else {
      // Close menu
      mobileMenu?.classList.add('translate-y-full', 'opacity-0', 'pointer-events-none');
      mobileMenu?.classList.remove('translate-y-0', 'opacity-100');

      // Animate menu items
      mobileMenuItems.forEach(item => {
        item.classList.add('translate-y-4', 'opacity-0');
        item.classList.remove('translate-y-0', 'opacity-100');
      });
    }
  }

  function closeMobileMenu() {
    if (isMenuOpen) {
      toggleMobileMenu();
    }
  }

  // Event listeners
  mobileMenuToggle?.addEventListener('click', toggleMobileMenu);

  mobileMenuLinks.forEach(link => {
    link.addEventListener('click', closeMobileMenu);
  });

  // Close menu when clicking outside
  document.addEventListener('click', event => {
    const target = event.target as Element;
    if (isMenuOpen && !mobileMenu?.contains(target) && !mobileMenuToggle?.contains(target)) {
      closeMobileMenu();
    }
  });

  // Navbar hide/show on scroll
  const navbar = document.getElementById('navbar');
  let lastScrollY = window.scrollY;
  let ticking = false;

  function handleNavbarScroll() {
    const currentScrollY = window.scrollY;

    if (currentScrollY <= 0) {
      // At top of page
      navbar?.classList.remove('sm:-translate-y-full');
      navbar?.classList.add('sm:translate-y-0');
    } else if (currentScrollY > lastScrollY) {
      // Scrolling down - hide navbar
      navbar?.classList.remove('sm:translate-y-0');
      navbar?.classList.add('sm:-translate-y-full');
    } else {
      // Scrolling up - show navbar
      navbar?.classList.remove('sm:-translate-y-full');
      navbar?.classList.add('sm:translate-y-0');
    }

    lastScrollY = currentScrollY;
    ticking = false;
  }

  window.addEventListener('scroll', () => {
    if (!ticking) {
      window.requestAnimationFrame(handleNavbarScroll);
      ticking = true;
    }
  });
</script>
