---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import ArchiveProjectCard from '../components/Shared/ArchiveProjectCard.astro';
import { archiveProjects } from '../utils/projects';
import '../styles/global.css';

const categories = ['All', 'Data Analytics', 'Software Engineering', 'Other'];
---

<Layout title='Project Archive | Subin Shrestha' description='A complete archive of my projects'>
  <div class='w-full'>
    <div class='w-full max-w-7xl mx-auto px-4'>
      <Navbar />

      <main class='min-h-screen p-4 md:p-10 lg:p-20 pt-20 md:pt-32'>
        <!-- Page Title -->
        <div class='mb-12'>
          <a
            href='/'
            class='inline-flex items-center gap-2 text-teal-300 hover:text-teal-200 transition-colors duration-200 mb-4 scroll-float-up'
          >
            <svg
              xmlns='http://www.w3.org/2000/svg'
              width='20'
              height='20'
              viewBox='0 0 24 24'
              fill='none'
              stroke='currentColor'
              stroke-width='2'
              stroke-linecap='round'
              stroke-linejoin='round'
            >
              <line x1='19' y1='12' x2='5' y2='12'></line>
              <polyline points='12 19 5 12 12 5'></polyline>
            </svg>
            Back
          </a>
          <h1 class='text-4xl md:text-5xl font-bold text-slate-200 mb-4 scroll-float-up'>
            All Projects
          </h1>
          <p class='text-teal-300 scroll-float-up'>
            A collection of projects I've worked on over the years
          </p>
        </div>

        <!-- Filter Buttons -->
        <div class='flex flex-wrap gap-3 mb-8 scroll-float-up-delay-1'>
          {
            categories.map((category) => (
              <button
                data-filter={category}
                class={`filter-btn px-4 py-2 rounded-md font-medium transition-all duration-300 ${
                  category === 'All'
                    ? 'bg-teal-400/10 text-teal-300'
                    : 'bg-light-navy text-slate-400 hover:bg-white/5 hover:text-slate-200'
                }`}
              >
                {category}
              </button>
            ))
          }
        </div>

        <!-- Projects Table Header (Desktop Only) -->
        <div class='hidden md:grid md:grid-cols-[80px_1fr_2fr_80px] gap-6 px-4 mb-4 text-sm font-mono text-slate-400 border-b border-slate-700 pb-2 scroll-float-up-delay-2'>
          <div>Year</div>
          <div>Title</div>
          <div>Built with</div>
          <div>Link</div>
        </div>

        <!-- Projects List -->
        <div class='space-y-2' id='projects-container'>
          {
            archiveProjects.map((project) => (
              <div class='project-item scroll-float-up' data-category={project.category}>
                <ArchiveProjectCard {...project} />
              </div>
            ))
          }
        </div>

        <!-- No Results Message -->
        <div id='no-results' class='hidden text-center py-12 text-slate-400'>
          <p class='text-lg'>No projects found in this category.</p>
        </div>
      </main>

      <Footer />
    </div>
  </div>
</Layout>

<script>
  // Filter functionality
  const filterButtons = document.querySelectorAll('.filter-btn');
  const projectItems = document.querySelectorAll('.project-item');
  const noResultsMessage = document.getElementById('no-results');

  filterButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const filter = button.getAttribute('data-filter');

      // Update active button
      filterButtons.forEach((btn) => {
        btn.classList.remove('bg-teal-400/10', 'text-teal-300');
        btn.classList.add('bg-light-navy', 'text-slate-400');
      });
      button.classList.remove('bg-light-navy', 'text-slate-400');
      button.classList.add('bg-teal-400/10', 'text-teal-300');

      // Filter projects with animation
      let visibleCount = 0;

      projectItems.forEach((item, index) => {
        const category = item.getAttribute('data-category');

        if (filter === 'All' || category === filter) {
          // Show item
          setTimeout(() => {
            item.classList.remove('hidden');
            (item as HTMLElement).style.opacity = '0';
            (item as HTMLElement).style.transform = 'translateY(20px)';

            requestAnimationFrame(() => {
              (item as HTMLElement).style.transition = 'opacity 0.4s ease-out, transform 0.4s ease-out';
              (item as HTMLElement).style.opacity = '1';
              (item as HTMLElement).style.transform = 'translateY(0)';
            });
          }, index * 30); // Stagger animation

          visibleCount++;
        } else {
          // Hide item
          (item as HTMLElement).style.opacity = '0';
          (item as HTMLElement).style.transform = 'translateY(-20px)';
          setTimeout(() => {
            item.classList.add('hidden');
          }, 300);
        }
      });

      // Show/hide no results message
      if (visibleCount === 0) {
        noResultsMessage?.classList.remove('hidden');
      } else {
        noResultsMessage?.classList.add('hidden');
      }
    });
  });
</script>

<style>
  .project-item {
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
  }

  .filter-btn {
    cursor: pointer;
  }

  .filter-btn:active {
    transform: scale(0.95);
  }
</style>
